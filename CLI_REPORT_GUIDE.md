# CLI报告显示功能说明

## 功能概述

系统现在会在每次AI决策后在命令行界面显示详细的行情分析报告,包括:

- 📈 **市场概况**: 当前价格、24小时涨跌、成交量
- 📐 **技术指标**: 趋势、动量、RSI、MACD、布林带、成交量分析
- 💼 **当前仓位**: 持仓方向、数量、盈亏、持仓时间
- 🤖 **AI决策**: 操作建议、置信度、仓位大小、杠杆倍数、止盈止损
- 💭 **分析理由**: AI给出的详细技术分析说明

---

## 报告示例

```
================================================================================
  📊 AI Trading Decision Report - ETH @ 2025-10-25 08:05:36
================================================================================

📈 Market Overview:
  Price:        $3929.05
  24h Change:   🔴 -0.38%
  24h Volume:   $1330658854.07

📐 Technical Indicators:
  Trend:        🔴 BEARISH (下跌趋势)
  Momentum:     📉 BEARISH (弱势下跌)
  RSI(14):      49.83 (正常)
  MACD:         DIF=-0.0611, DEA=0.9410, HIST=-1.0021
  Bollinger:    3941.24 / 3932.58 / 3923.92 (LOWER_HALF)
  Volume:       ⚪ NORMAL (正常)

💼 Current Position:
  Status:       No open position

🤖 AI Decision:
  Action:       ⏸️  HOLD
  Confidence:   45% [█████████░░░░░░░░░░░]

💭 Analysis Reasoning:
  市场处于高度盘整状态，技术指标显示方向不明。价格3929.05与所有关键均线
  几乎重合，表明缺乏明确趋势。MACD在零轴下方但未形成明确金叉/死叉，
  RSI处于中性区域，布林带内价格位置显示轻微偏空但未触及下轨...
================================================================================
```

---

## 开仓决策示例

当AI建议开仓时,报告会显示更多详细信息:

```
🤖 AI Decision:
  Action:       🟢 OPEN LONG
  Confidence:   85% [█████████████████░░░]
  Position Size: 10.0%
  Leverage:     5x
  Stop Loss:    $3850.00 (-2.00%)
  Take Profit:  $4050.00 (+3.00%)
  Risk Level:   🟡 MEDIUM (中风险)
  Hold Period:  MEDIUM
```

---

## 视觉元素说明

### 📊 表情符号含义

**价格变化:**
- 🟢 = 上涨
- 🔴 = 下跌

**趋势指标:**
- 🟢 BULLISH = 上涨趋势
- 🔴 BEARISH = 下跌趋势
- ⚪ NEUTRAL = 震荡/中性

**动量指标:**
- 🚀 BULLISH = 强势上涨
- 📉 BEARISH = 弱势下跌
- ➡️ NEUTRAL = 动能中性

**成交量:**
- 🟢 STRONG BUYING = 强力买入
- 🔴 STRONG SELLING = 强力卖出
- ⚪ NORMAL = 正常

**RSI状态:**
- (超买) = RSI > 70
- (超卖) = RSI < 30
- (正常) = 30 ≤ RSI ≤ 70

**操作建议:**
- 🟢 OPEN LONG = 开多单
- 🔴 OPEN SHORT = 开空单
- ➕ ADD POSITION = 加仓
- ❌ CLOSE POSITION = 平仓
- ⏸️ HOLD = 持有/观望

**风险等级:**
- 🟢 LOW = 低风险
- 🟡 MEDIUM = 中风险
- 🔴 HIGH = 高风险

### 📊 置信度进度条

```
100% [████████████████████]  非常高置信度
 80% [████████████████░░░░]  高置信度
 60% [████████████░░░░░░░░]  中等置信度
 45% [█████████░░░░░░░░░░░]  较低置信度
 30% [██████░░░░░░░░░░░░░░]  低置信度
```

---

## 使用场景

### 1. 实时监控
```bash
./aitrading
```
系统每5分钟会自动显示所有配置币种的决策报告

### 2. 单次测试
```bash
go run test_cli_report.go
```
测试单个币种的报告显示效果

### 3. 查看历史日志
报告只显示在CLI,不会记录到日志文件。如需保存:
```bash
./aitrading | tee decision_reports.txt
```

---

## 报告内容解读

### 市场概况部分
- **Price**: 当前市场价格
- **24h Change**: 过去24小时的价格变化百分比
- **24h Volume**: 过去24小时的成交量(美元)

### 技术指标部分
- **Trend**: 基于SMA/EMA的趋势判断
- **Momentum**: 基于MACD的动量状态
- **RSI**: 相对强弱指标,衡量超买超卖
- **MACD**: DIF/DEA/HIST三个值,判断买卖信号
- **Bollinger**: 上轨/中轨/下轨,价格所在位置
- **Volume**: 成交量与价格的关系分析

### 当前仓位部分
如果有持仓,显示:
- **Side**: LONG(多单)或SHORT(空单)
- **Size**: 持仓数量
- **Entry Price**: 开仓价格
- **Current P&L**: 当前盈亏百分比
- **Holding Time**: 持仓时长

### AI决策部分
- **Action**: AI建议的操作
- **Confidence**: AI对该决策的信心程度(0-100%)
- **Position Size**: 建议使用的资金比例
- **Leverage**: 建议的杠杆倍数
- **Stop Loss**: 止损价格和比例
- **Take Profit**: 止盈价格和比例
- **Risk Level**: 该交易的风险等级
- **Hold Period**: 预期持仓时长(SHORT/MEDIUM/LONG)

### 分析理由部分
AI给出的详细技术分析说明,解释为什么做出这个决策

---

## 配置选项

报告显示是自动的,无需额外配置。但你可以:

### 关闭日志输出只看报告
修改config.yaml:
```yaml
monitoring:
  log_level: "error"  # 只显示错误,报告照常显示
```

### 重定向日志到文件
```yaml
monitoring:
  log_file: "logs/trading.log"  # 日志写入文件,CLI只显示报告
```

---

## 多币种显示

当配置多个币种时,系统会依次显示每个币种的报告:

```
================================================================================
  📊 AI Trading Decision Report - ETH @ 2025-10-25 08:05:36
================================================================================
[ETH的报告内容...]
================================================================================

================================================================================
  📊 AI Trading Decision Report - BTC @ 2025-10-25 08:05:45
================================================================================
[BTC的报告内容...]
================================================================================

================================================================================
  📊 AI Trading Decision Report - DOGE @ 2025-10-25 08:05:52
================================================================================
[DOGE的报告内容...]
================================================================================
```

---

## 技术实现

报告功能位于`main.go`的`printDecisionReport()`函数,特点:

- ✅ **自动换行**: 中文和英文混排正确换行
- ✅ **对齐排版**: 固定80字符宽度,美观整洁
- ✅ **颜色标识**: 使用emoji代替ANSI颜色(更兼容)
- ✅ **实时显示**: 每次AI决策后立即显示
- ✅ **不影响日志**: 使用fmt.Println直接输出到stdout

---

## 故障排除

### 问题1: 报告显示乱码
**原因**: 终端不支持UTF-8
**解决**: 设置终端编码为UTF-8

### 问题2: 表情符号不显示
**原因**: 终端字体不支持emoji
**解决**: 使用支持emoji的终端字体(如Noto、Segoe UI等)

### 问题3: 对齐错乱
**原因**: 终端宽度小于80字符
**解决**: 调整终端窗口至少80字符宽

---

## 示例场景

### 场景1: HOLD决策
```
Action:       ⏸️  HOLD
Confidence:   45% [█████████░░░░░░░░░░░]

理由: 指标分歧,不满足开仓条件
```

### 场景2: 开多单
```
Action:       🟢 OPEN LONG
Confidence:   85% [█████████████████░░░]
Position Size: 10.0%
Leverage:     5x
Stop Loss:    $3850.00 (-2.00%)
Take Profit:  $4050.00 (+3.00%)
Risk Level:   🟡 MEDIUM (中风险)

理由: 多个技术指标共振,趋势向上,RSI从超卖区回升...
```

### 场景3: 平仓
```
Action:       ❌ CLOSE POSITION
Confidence:   100% [████████████████████]

理由: 止盈价格已触发
```

---

## 与日志的区别

| 特性 | CLI报告 | 日志文件 |
|------|---------|----------|
| 格式 | 美观排版 | 结构化JSON |
| 内容 | 完整详细 | 关键字段 |
| 用途 | 实时查看 | 历史分析 |
| 位置 | stdout | logs/trading.log |
| 颜色 | 有emoji | 无emoji |

---

**建议**:
- 实时监控时查看CLI报告
- 事后分析时查看日志文件
- 两者互补,各有优势

---

**更新时间**: 2025-10-25
**版本**: v1.2
